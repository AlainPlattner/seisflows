#!/usr/bin/python -u

import sys

from seisflows.tools.codetools import join, loadjson
from seisflows.tools.configtools import ConfigObj, ParameterObj

PAR = ParameterObj('SeisflowsParameters')
PATH = ParameterObj('SeisflowsPaths')
OBJ = ConfigObj('SeisflowsObjects')


if __name__ == '__main__':

    mypath = sys.argv[1]

    parname = 'SeisflowsParameters.json'
    pathname = 'SeisflowsPaths.json'
    objname = 'SeisflowsObjects'

    parfile = join(mypath,parname)
    pathfile = join(mypath,pathname)

    PAR.update(loadjson(parfile))
    PATH.update(loadjson(pathfile))
    OBJ.load(objname,mypath)

    import optimize
    import preprocess
    import postprocess
    import solver
    import system
    import workflow

    system.check()
    solver.check()
    optimize.check()
    preprocess.check()
    postprocess.check()
    workflow.check()

    workflow.main()

